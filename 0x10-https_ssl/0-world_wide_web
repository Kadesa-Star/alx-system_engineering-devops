#!/usr/bin/env bash
# script to report information about server domains
# shellcheck disable=SC2086

check_domain() {
    # space separated list of sub domains
    SUBDOMAINS='www lb-01 web-01 web-02'

    if [ -z "$1" ]; then
        exit
    fi

    # no sub domain specified, do all
    if [ -z "$2" ]; then
        echo "$SUBDOMAINS" | awk -v domain="$1" 'BEGIN { RS=" " }
        {
            cmd = "dig " $1 "." domain " | grep -A1 \"ANSWER SECTION:\" | tail -n1";
            if ( (cmd | getline line) > 0 ) {
                split(line, ARR, /[[:space:]]+/);
                if (length(ARR) > 4) {
                    print "The subdomain " $1 " is a " ARR[4] " record and points to " ARR[5];
                } else {
                    print "The subdomain " $1 " did not return a valid record.";
                }
            } else {
                print "The subdomain " $1 " did not return a valid record.";
            }
            close(cmd);
        }'
    else
        dig "$2.$1" | awk '
        /ANSWER SECTION:/ {
            getline;
            split($0, ARR, /[[:space:]]+/);
            if (length(ARR) > 4) {
                print "The subdomain " "'$2'" " is a " ARR[4] " record and points to " ARR[5];
            } else {
                print "The subdomain " "'$2'" " did not return a valid record.";
            }
        }'
    fi
}

check_domain "$1" "$2"
