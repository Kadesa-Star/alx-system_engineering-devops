#!/usr/bin/env bash
# This script reports information about server domains
# shellcheck disable=SC2086

# Function to check domain information
check_domain() {
    # Space-separated list of subdomains
    SUBDOMAINS="www lb-01 web-01 web-02"

    # Exit if no domain is provided
    if [ -z "$1" ]; then
        exit 1
    fi

    # If no subdomain is specified, check all subdomains
    if [ -z "$2" ]; then
        echo "$SUBDOMAINS" | awk -v domain="$1" '
        BEGIN { RS=" " }
        {
            cmd = "dig " $1 "." domain " | grep -A1 '\''ANSWER SECTION:'\'' | tail -n1";
            cmd | getline result;
            close(cmd);
            split(result, fields, " ");
            if (length(fields) >= 5) {
                print "The subdomain " $1 " is a " fields[4] " record and points to " fields[5];
            } else {
                print "The subdomain " $1 " did not return a valid record.";
            }
        }'
    else
        dig "$2.$1" | grep -A1 "ANSWER SECTION:" | tail -n1 | awk '
        {
            split($0, fields, " ");
            if (length(fields) >= 5) {
                print "The subdomain " fields[1] " is a " fields[4] " record and points to " fields[5];
            } else {
                print "The subdomain " fields[1] " did not return a valid record.";
            }
        }'
    fi
}

# Call the check_domain function with provided arguments
check_domain "$1" "$2"
